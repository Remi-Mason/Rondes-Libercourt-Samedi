<!DOCTYPE html>
<html lang="fr">
<head>
<link rel="icon" type="image/png" href="favicon.png?v=2">
<link rel="shortcut icon" href="favicon.png?v=2">
<link rel="apple-touch-icon" href="favicon.png?v=2">
  <meta charset="utf-8" />
  <title>Planning rondier / intervenant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#f7f7f7; --txt:#111; --border:#000;
      --btn-bg:#fff; --btn-done:#2ecc71;
    }
    html, body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,system-ui,sans-serif;
      background: linear-gradient(120deg, #2193b0, #6dd5ed);
      color: #fff;
    }
    .wrap{ max-width:500px; margin:0 auto; padding:12px 14px 18px; }
    header{ display:flex; justify-content:center; align-items:center; padding:2px 0 5px; }
    header img{ max-width:250px; height:auto; display:block; }
    h1{ text-align:center; font-size:18px; margin:8px 0 16px; font-weight:700; }

    .row{
      display: grid;
      grid-template-columns: minmax(260px, 300px) auto;
      justify-content: center;
      gap: 10px;
      align-items: center;
      padding: 6px 0;
      border-bottom: 1px dashed rgba(0,0,0,.15);
    }

    .btn{
      display:block; background:var(--btn-bg); color:var(--txt);
      border:2px solid var(--border); border-radius:1000px; padding:10px 14px;
      font-weight:600; text-decoration:none; line-height:1; box-shadow:0 1px 0 rgba(0,0,0,.04);
      touch-action:manipulation; -webkit-tap-highlight-color:transparent;
    }
    .btn:active{ transform:translateY(1px); }

    .time-btn{ min-width:76px; text-align:center; font-size:14px; padding:10px 14px; }
    .time-btn.done{ background:var(--btn-done); color:#fff; border-color:#0e8b47; }

    @media (max-width:420px){
      .wrap{ padding:10px 10px 16px; }
      .row{ gap:8px; }
      .time-btn{ min-width:70px; padding:10px 12px; font-size:13px; }
      .site-btn{ padding:10px 12px; }
    }
    .site-btn {
      max-width: 300px;
      text-align: center;
      white-space: normal;
      margin: 0;
      padding-left: 10px;
      padding-right: 10px;
      background-color: #f5f5dc;
    }
    .nav-links {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 5px 0 15px;
    }
    .nav-btn {
      background: #333;
      color: #fff;
      border: 2px solid #FFF;
      border-radius: 1000px;
      padding: 8px 14px;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
    }
    .reset-btn {
      background: #b22222; /* couleur différente si tu veux */
      border: 2px solid #fff;
      color: #fff;
    }
    .reset-btn:hover {
      background: #d32f2f;
    }
	.chrono-btn, .reset-chrono {
  font-size: 13px;
  text-align: center;
  border: 2px solid #fff;
  border-radius: 1000px;
  padding: 8px 12px;
  cursor: pointer;
}

.chrono-btn {
  margin: -5px 0 2px;
  min-width: 140px;
  background: #555;
  color: #fff;
    padding: 8px 20px;
}
.chrono-btn.running { background: #0066cc; } /* bleu quand ça tourne */
.chrono-btn.over { background: #c62828; }    /* rouge quand dépasse la durée */
.chrono-btn.blink { animation: blink 1s step-end infinite; }
@keyframes blink { 50% { opacity: .35; } }

.reset-chrono {
  display: flex;               /* active flexbox */
  align-items: center;         /* centre verticalement */
  justify-content: center;     /* centre horizontalement */
  background: #dddddd;
  margin: 0 0 0 3px; 
  font-size: 20px;
  width: 35px;
  height: 35px;
  border: 2px solid #000; 
  border-radius: 30%;          /* rond parfait */
  color: #000; 
  line-height: 1;              /* évite les décalages */
  padding: 0;
    padding-left: 2px;
  margin: -5px 0 2px;
}
.reset-chrono:active {
  transform: translateY(1px);
}
.consignes-hidden { display: none; } /* blocs sources cachés */

#consignes-overlay {
  display: none; /* caché par défaut */
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.8);
  z-index: 9999;
  justify-content: center;
  align-items: center;
  padding: 16px;
}

#consignes-overlay.open { display: flex; }

.consignes-box {
background: rgba(34, 34, 34, 0.9); /* gris foncé avec transparence */
  color: #fff;      
  width: min(620px, 92vw);
  max-height: 80vh;
  overflow: auto;
  padding: 20px 24px;
  border-radius: 12px;
  position: relative;
  box-shadow: 0 10px 30px rgba(0,0,0,.35);
}

.close-consignes{
  position: absolute;
  top: 8px; right: 8px;
  border: none; background: transparent;
  font-size: 20px; cursor: pointer;
    color: #fff; 
}
.consignes-btn {
  margin: -5px 0 2px;
  background: #4B0082;   /* violet foncé */
  color: #fff;           /* texte blanc pour le contraste */
  border: 2px solid #000;
  border-radius: 1000px;
  padding: 8px 20px;
  font-size: 13px;
  cursor: pointer;
}
.tools-area {
  grid-column: 1 / -1;   /* occupe toute la largeur */
  text-align: center;    /* ✅ centre horizontalement le contenu */
    margin: 6px 0 1px;
}

.tools-toggle, .tools-close {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 8px 14px;
  border: 2px solid #fff;
  border-radius: 1000px;
background: rgba(34, 34, 34, 0.9); /* gris foncé avec transparence */
  color: #fff;
  font-weight: 600;
  cursor: pointer;
  margin: -5px 0 3px;
   font-size: 20px;
  
}

.tools-body {
  margin: 1px 0 5px;
  display: none;
  gap: 8px;
  justify-content: center;   /* centre horizontalement */
  align-items: center;       /* ✅ centre verticalement tous les boutons */
  flex-wrap: wrap;

}

.tools-area.open .tools-toggle { display: none; }
.tools-area.open .tools-body { display: flex; }

.right {
  display: flex;
  align-items: center;
  gap: 10px;        /* espace entre heure et “Outils” */
  flex-wrap: wrap;  /* si ça manque de place, ça passe dessous proprement */
}

  </style>
</head>
<body>
  <div class="wrap">
    <header><img src="images/logo artemis.png" alt="Logo"></header>
    <div class="nav-links">
      <a class="btn nav-btn" href="https://remi-mason.github.io/Rondes-Index/" target="_blank" rel="noopener">Index</a>
      <button id="reset-btn" class="btn nav-btn reset-btn">Réinitialiser</button>
    </div>
    <h1>Rondes Libercourt (Samedi)</h1>

   <!-- ZI Libercourt — 20:15 -->
<div class="row">
  <a class="btn site-btn" target="_blank" rel="noopener"
     href="waze://?ll=50.490439,2.99401&navigate=yes">
    ZI Libercourt — Sécurité
    <span class="sub">Avenue Blaise Pascal, Libercourt</span>
  </a>

  <!-- TOUT ce qui est à droite de la ligne vit dans .right (2e colonne) -->
 <div class="right">
    <button class="btn time-btn" data-id="t2018">20:18</button>
  </div>

  <!-- zone outils en dessous -->
  <div class="tools-area">
    <button class="btn tools-toggle" aria-expanded="false">▾</button>
    <div class="tools-body">
      <button class="btn chrono-btn" data-duration="60">00:00 / 01:00:00</button>
      <button class="btn reset-chrono" title="Remettre à zéro">⟳</button>
      <button class="btn consignes-btn" data-consignes="#c-2015">Consignes</button>
      <button class="btn tools-close" title="Replier">▴</button>
    </div>
  </div>
</div> <!-- ✅ FIN de la première .row -->


<!-- ⚠️ Le bloc consignes caché sort de la .row pour ne pas casser la grille -->
<div class="consignes-hidden" id="c-2015">
  <h2>Consignes – ZI Libercourt</h2>
  <ul>
    <li>Vérifier portail nord + badge.</li>
    <li>Contrôle extincteurs zone A (x3) et RIA.</li>
    <li>Levée de doute visuelle avant appel PC.</li>
  </ul>
</div>

  <!-- 21:30 — STG Carvin -->
  <div class="row">
    <a class="btn site-btn" target="_blank" rel="noopener"
       href="waze://?ll=50.475376,2.960966&navigate=yes">
      STG Carvin
      <span class="sub">Rue Louis Joseph Gay Lussac</span>
    </a>
    <!-- TOUT ce qui est à droite de la ligne vit dans .right (2e colonne) -->
 <div class="right">
    <button class="btn time-btn" data-id="t2130">21:30</button>
  </div>

  <!-- zone outils en dessous -->
  <div class="tools-area">
    <button class="btn tools-toggle" aria-expanded="false">▾</button>
    <div class="tools-body">
      <button class="btn chrono-btn" data-duration="20">00:00 / 00:20:00</button>
      <button class="btn reset-chrono" title="Remettre à zéro">⟳</button>
      <button class="btn consignes-btn" data-consignes="#c-2130">Consignes</button>
      <button class="btn tools-close" title="Replier">▴</button>
    </div>
  </div>
</div> <!-- ✅ FIN de la première .row -->


<!-- ⚠️ Le bloc consignes caché sort de la .row pour ne pas casser la grille -->
<div class="consignes-hidden" id="c-2130">
  <h2>Consignes – STG Carvin</h2>
  <ul>
    <li>Vérifier portail nord + badge.</li>
    <li>Contrôle extincteurs zone A (x3) et RIA.</li>
    <li>Levée de doute visuelle avant appel PC.</li>
  </ul>
</div>

    <!-- ASPUZIL Seclin — 22:15 -->
    <div class="row">
      <a class="btn site-btn" target="_blank" rel="noopener"
         href="waze://?ll=50.560438,3.032184&navigate=yes">
        ASPUZIL Seclin — Sécurité
        <span class="sub">Rue Marcel Dassault, Seclin</span>
      </a>
 <!-- TOUT ce qui est à droite de la ligne vit dans .right (2e colonne) -->
 <div class="right">
    <button class="btn time-btn" data-id="t2215">22:15</button>
  </div>

  <!-- zone outils en dessous -->
  <div class="tools-area">
    <button class="btn tools-toggle" aria-expanded="false">▾</button>
    <div class="tools-body">
      <button class="btn chrono-btn" data-duration="60">00:00 / 01:00:00</button>
      <button class="btn reset-chrono" title="Remettre à zéro">⟳</button>
      <button class="btn consignes-btn" data-consignes="#c-2215">Consignes</button>
      <button class="btn tools-close" title="Replier">▴</button>
    </div>
  </div>
</div> <!-- ✅ FIN de la première .row -->


<!-- ⚠️ Le bloc consignes caché sort de la .row pour ne pas casser la grille -->
<div class="consignes-hidden" id="c-2215">
  <h2>Consignes – Seclin</h2>
  <ul>
    <li>Vérifier portail nord + badge.</li>
    <li>Contrôle extincteurs zone A (x3) et RIA.</li>
    <li>Levée de doute visuelle avant appel PC.</li>
  </ul>
</div>

    <!-- Leroy Merlin Lesquin — 23:30 -->
    <div class="row">
      <a class="btn site-btn" target="_blank" rel="noopener"
         href="waze://?ll=50.584527,3.088254&navigate=yes">
        Leroy Merlin Lesquin — Sécurité
        <span class="sub">51 route de Douai, Lesquin</span>
      </a>
      <!-- TOUT ce qui est à droite de la ligne vit dans .right (2e colonne) -->
 <div class="right">
    <button class="btn time-btn" data-id="t2335">23:30</button>
  </div>

  <!-- zone outils en dessous -->
  <div class="tools-area">
    <button class="btn tools-toggle" aria-expanded="false">▾</button>
    <div class="tools-body">
      <button class="btn chrono-btn" data-duration="20">00:00 / 00:20:00</button>
      <button class="btn reset-chrono" title="Remettre à zéro">⟳</button>
      <button class="btn consignes-btn" data-consignes="#c-2330">Consignes</button>
      <button class="btn tools-close" title="Replier">▴</button>
    </div>
  </div>
</div> <!-- ✅ FIN de la première .row -->


<!-- ⚠️ Le bloc consignes caché sort de la .row pour ne pas casser la grille -->
<div class="consignes-hidden" id="c-2330">
  <h2>Consignes – Leroy Merlin</h2>
  <ul>
    <li>Vérifier portail nord + badge.</li>
    <li>Contrôle extincteurs zone A (x3) et RIA.</li>
    <li>Levée de doute visuelle avant appel PC.</li>
  </ul>
</div>
    <!-- ZI Libercourt — 00:10 -->
    <div class="row">
      <a class="btn site-btn" target="_blank" rel="noopener"
         href="waze://?ll=50.490439,2.99401&navigate=yes">
        ZI Libercourt — Sécurité
        <span class="sub">Avenue Blaise Pascal, Libercourt</span>
      </a>
       <!-- TOUT ce qui est à droite de la ligne vit dans .right (2e colonne) -->
 <div class="right">
    <button class="btn time-btn" data-id="t0010">00:10</button>
  </div>

  <!-- zone outils en dessous -->
  <div class="tools-area">
    <button class="btn tools-toggle" aria-expanded="false">▾</button>
    <div class="tools-body">
      <button class="btn chrono-btn" data-duration="60">00:00 / 01:00:00</button>
      <button class="btn reset-chrono" title="Remettre à zéro">⟳</button>
      <button class="btn consignes-btn" data-consignes="#c-0010">Consignes</button>
      <button class="btn tools-close" title="Replier">▴</button>
    </div>
  </div>
</div> <!-- ✅ FIN de la première .row -->


<!-- ⚠️ Le bloc consignes caché sort de la .row pour ne pas casser la grille -->
<div class="consignes-hidden" id="c-0010">
  <h2>Consignes – ZI Libercourt</h2>
  <ul>
    <li>Vérifier portail nord + badge.</li>
    <li>Contrôle extincteurs zone A (x3) et RIA.</li>
    <li>Levée de doute visuelle avant appel PC.</li>
  </ul>
</div>
	  <!-- 01:30 — STG Carvin -->
  <div class="row">
    <a class="btn site-btn" target="_blank" rel="noopener"
       href="waze://?ll=50.475376,2.960966&navigate=yes">
      STG Carvin
      <span class="sub">Rue Louis Joseph Gay Lussac</span>
    </a>
    <!-- TOUT ce qui est à droite de la ligne vit dans .right (2e colonne) -->
 <div class="right">
    <button class="btn time-btn" data-id="t0120">01:20</button>
  </div>

  <!-- zone outils en dessous -->
  <div class="tools-area">
    <button class="btn tools-toggle" aria-expanded="false">▾</button>
    <div class="tools-body">
      <button class="btn chrono-btn" data-duration="20">00:00 / 00:20:00</button>
      <button class="btn reset-chrono" title="Remettre à zéro">⟳</button>
      <button class="btn consignes-btn" data-consignes="#c-0120">Consignes</button>
      <button class="btn tools-close" title="Replier">▴</button>
    </div>
  </div>
</div> <!-- ✅ FIN de la première .row -->


<!-- ⚠️ Le bloc consignes caché sort de la .row pour ne pas casser la grille -->
<div class="consignes-hidden" id="c-0120">
  <h2>Consignes – STG Carvin</h2>
  <ul>
    <li>Vérifier portail nord + badge.</li>
    <li>Contrôle extincteurs zone A (x3) et RIA.</li>
    <li>Levée de doute visuelle avant appel PC.</li>
  </ul>
</div>

    <!-- ASPUZIL — 02:00 -->
    <div class="row">
      <a class="btn site-btn" target="_blank" rel="noopener"
         href="waze://?ll=50.560438,3.032184&navigate=yes">
        ASPUZIL Seclin — Sécurité
        <span class="sub">Rue Marcel Dassault, Seclin</span>
      </a>
 <!-- TOUT ce qui est à droite de la ligne vit dans .right (2e colonne) -->
 <div class="right">
    <button class="btn time-btn" data-id="t0200">02:00</button>
  </div>

  <!-- zone outils en dessous -->
  <div class="tools-area">
    <button class="btn tools-toggle" aria-expanded="false">▾</button>
    <div class="tools-body">
      <button class="btn chrono-btn" data-duration="60">00:00 / 01:00:00</button>
      <button class="btn reset-chrono" title="Remettre à zéro">⟳</button>
      <button class="btn consignes-btn" data-consignes="#c-0200">Consignes</button>
      <button class="btn tools-close" title="Replier">▴</button>
    </div>
  </div>
</div> <!-- ✅ FIN de la première .row -->


<!-- ⚠️ Le bloc consignes caché sort de la .row pour ne pas casser la grille -->
<div class="consignes-hidden" id="c-0200">
  <h2>Consignes – Seclin</h2>
  <ul>
    <li>Vérifier portail nord + badge.</li>
    <li>Contrôle extincteurs zone A (x3) et RIA.</li>
    <li>Levée de doute visuelle avant appel PC.</li>
  </ul>
</div>
		  <!-- 03:30 — STG Carvin -->
  <div class="row">
    <a class="btn site-btn" target="_blank" rel="noopener"
       href="waze://?ll=50.475376,2.960966&navigate=yes">
      STG Carvin
      <span class="sub">Rue Louis Joseph Gay Lussac</span>
    </a>
  <!-- TOUT ce qui est à droite de la ligne vit dans .right (2e colonne) -->
 <div class="right">
    <button class="btn time-btn" data-id="t0300">03:20</button>
  </div>

  <!-- zone outils en dessous -->
  <div class="tools-area">
    <button class="btn tools-toggle" aria-expanded="false">▾</button>
    <div class="tools-body">
      <button class="btn chrono-btn" data-duration="20">00:00 / 00:20:00</button>
      <button class="btn reset-chrono" title="Remettre à zéro">⟳</button>
      <button class="btn consignes-btn" data-consignes="#c-0320">Consignes</button>
      <button class="btn tools-close" title="Replier">▴</button>
    </div>
  </div>
</div> <!-- ✅ FIN de la première .row -->


<!-- ⚠️ Le bloc consignes caché sort de la .row pour ne pas casser la grille -->
<div class="consignes-hidden" id="c-0320">
  <h2>Consignes – STG Carvin</h2>
  <ul>
    <li>Vérifier portail nord + badge.</li>
    <li>Contrôle extincteurs zone A (x3) et RIA.</li>
    <li>Levée de doute visuelle avant appel PC.</li>
  </ul>
</div>

    <!-- ASPUZIL — 04:00 -->
    <div class="row">
      <a class="btn site-btn" target="_blank" rel="noopener"
         href="waze://?ll=50.560438,3.032184&navigate=yes">
        ASPUZIL Seclin — Sécurité
        <span class="sub">Rue Marcel Dassault, Seclin</span>
      </a>
<!-- TOUT ce qui est à droite de la ligne vit dans .right (2e colonne) -->
 <div class="right">
    <button class="btn time-btn" data-id="t0400">04:00</button>
  </div>

  <!-- zone outils en dessous -->
  <div class="tools-area">
    <button class="btn tools-toggle" aria-expanded="false">▾</button>
    <div class="tools-body">
      <button class="btn chrono-btn" data-duration="60">00:00 / 01:00:00</button>
      <button class="btn reset-chrono" title="Remettre à zéro">⟳</button>
      <button class="btn consignes-btn" data-consignes="#c-0400">Consignes</button>
      <button class="btn tools-close" title="Replier">▴</button>
    </div>
  </div>
</div> <!-- ✅ FIN de la première .row -->


<!-- ⚠️ Le bloc consignes caché sort de la .row pour ne pas casser la grille -->
<div class="consignes-hidden" id="c-0400">
  <h2>Consignes – Seclin</h2>
  <ul>
    <li>Vérifier portail nord + badge.</li>
    <li>Contrôle extincteurs zone A (x3) et RIA.</li>
    <li>Levée de doute visuelle avant appel PC.</li>
  </ul>
</div>
	
	
	<div id="consignes-overlay" aria-hidden="true">
  <div class="consignes-box" role="dialog" aria-modal="true" aria-labelledby="consignes-title">
    <button class="close-consignes" type="button" aria-label="Fermer">✖</button>
    <div id="consignes-body"></div>
  </div>
  </div>
<script>
  const ctx = new (window.AudioContext || window.webkitAudioContext)({ latencyHint: "interactive" });
  const STORAGE_KEY = "rondesState_libercourt_samedi"; // clé unique pour cette page

  function unlockAudio() { if (ctx.state === "suspended") ctx.resume(); }
  window.addEventListener("pointerdown", unlockAudio, { passive: true });
  window.addEventListener("keydown",   unlockAudio, { passive: true });

  async function loadBuffer(url) {
    const res = await fetch(url);
    const arr = await res.arrayBuffer();
    return await ctx.decodeAudioData(arr);
  }

  const buffers = { click: null, success: null };
  let successPlayed = false;

  function play(buf, gainValue = 1.0){
    if (!buf) return;
    const src = ctx.createBufferSource();
    src.buffer = buf;
    const gainNode = ctx.createGain();
    gainNode.gain.value = gainValue;
    src.connect(gainNode).connect(ctx.destination);
    src.start(0);
  }

  function saveState() {
    const states = {};
    document.querySelectorAll(".time-btn").forEach(btn => {
      states[btn.dataset.id] = btn.classList.contains("done");
    });
    localStorage.setItem(STORAGE_KEY, JSON.stringify(states));
  }

  function loadState() {
    const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
    document.querySelectorAll(".time-btn").forEach(btn => {
      if (saved[btn.dataset.id]) {
        btn.classList.add("done");
        btn.setAttribute("aria-pressed", "true");
      }
    });
  }

  function areAllDone() {
    return [...document.querySelectorAll(".time-btn")]
      .every(b => b.classList.contains("done"));
  }

  function toggleBtn(e) {
    const btn = e.currentTarget;
    play(buffers.click, 0.5);
    btn.classList.toggle("done");
    btn.setAttribute("aria-pressed", btn.classList.contains("done") ? "true" : "false");

    if (areAllDone()) {
      if (!successPlayed) {
        play(buffers.success, 2.0);
        successPlayed = true;
      }
    } else {
      successPlayed = false;
    }
    saveState();
  }

  (async function init() {
    [buffers.click, buffers.success] = await Promise.all([
      loadBuffer("sounds/bubble.mp3"),
      loadBuffer("sounds/success.mp3"),
    ]);

    document.querySelectorAll(".time-btn").forEach(btn => {
      btn.addEventListener("click", toggleBtn);
      btn.setAttribute("role","button");
      btn.setAttribute("aria-pressed","false");
      btn.classList.remove("done");
    });

    loadState();

    document.getElementById("reset-btn").addEventListener("click", () => {
      localStorage.removeItem(STORAGE_KEY);
      document.querySelectorAll(".time-btn").forEach(btn => {
        btn.classList.remove("done");
        btn.setAttribute("aria-pressed", "false");
      });
      successPlayed = false;
    });
  })();
  // ================= Chronos indépendants (start/pause sur clic, reset dédié, dépassement rouge) =================
(function() {
  const ZERO = new Date(0);

  // Format adaptatif : HH:MM:SS si > 60 min, sinon MM:SS
  const fmt = (sec) => {
    const s = Math.max(0, Math.floor(sec));
    const h = Math.floor(s / 3600);
    const m = Math.floor((s % 3600) / 60);
    const ss = s % 60;
    if (h > 0) {
      return String(h).padStart(2,'0') + ':' + String(m).padStart(2,'0') + ':' + String(ss).padStart(2,'0');
    }
    return String(m).padStart(2,'0') + ':' + String(ss).padStart(2,'0');
  };

  class Chrono {
    constructor(btn, resetBtn) {
      this.btn = btn;
      this.resetBtn = resetBtn;
      this.target = Number(btn.dataset.duration || 60) * 60; // en secondes
      this.running = false;
      this.accum = 0;   // secondes accumulées
      this.t0 = 0;      // performance.now() au démarrage
      this.raf = null;

      this.render(0); // texte initial

      // Clic simple = start/pause/restart (cycle)
      btn.addEventListener('click', () => this.toggle());

      // Bouton reset = remet à zéro
      resetBtn.addEventListener('click', () => this.reset());
    }

    toggle() {
      if (this.running) this.pause();
      else this.start();
    }

start() {
  if (this.running) return;
  this.running = true;
  this.t0 = performance.now();   // point de reprise
  this.btn.classList.add('running');
  this.tick();
}

pause() {
  if (!this.running) return;
  const e = this.elapsed();      // <<< calcule AVANT de stopper
  this.running = false;
  this.accum = e;                // fige la valeur accumulée
  cancelAnimationFrame(this.raf);
  this.btn.classList.remove('running');
  this.render(e);                // affiche la valeur au moment de la pause
}

    reset() {
      this.running = false;
      cancelAnimationFrame(this.raf);
      this.accum = 0;
      this.t0 = 0;
      this.btn.classList.remove('running','over','blink');
      this.render(0);
    }

    elapsed() {
      return this.running ? this.accum + (performance.now() - this.t0)/1000 : this.accum;
    }

    tick = () => {
      const e = this.elapsed();

      // Ne JAMAIS s'arrêter : on continue d'afficher
      if (e >= this.target) {
        // Passe en rouge + clignote une fois la cible atteinte/dépassée
        this.btn.classList.add('over','blink');
      } else {
        this.btn.classList.remove('over','blink');
      }

      this.render(e);
      this.raf = requestAnimationFrame(this.tick);
    }

    render(e) {
      this.btn.textContent = `${fmt(e)} / ${fmt(this.target)}`;
    }
  }

  // Instanciation : on associe chaque .chrono-btn à son .reset-chrono qui suit
  const chronos = [];
  document.querySelectorAll('.chrono-btn').forEach(btn => {
    // On prend le bouton reset qui est juste après dans le DOM
    let resetBtn = btn.nextElementSibling;
    if (!resetBtn || !resetBtn.classList.contains('reset-chrono')) {
      // fallback : on cherche dans la même ligne
      resetBtn = btn.parentElement.querySelector('.reset-chrono');
    }
    if (resetBtn) chronos.push(new Chrono(btn, resetBtn));
  });
})();
// Ouvre l'overlay avec du contenu pris depuis un sélecteur CSS (ex: "#c-2015")
function ouvrirConsignesDepuisSelector(selector) {
  const src = document.querySelector(selector);
  const body = document.getElementById('consignes-body');
  body.innerHTML = src ? src.innerHTML : "<p>Aucune consigne pour ce site.</p>";
  document.getElementById('consignes-overlay').classList.add('open');
  document.getElementById('consignes-overlay').setAttribute('aria-hidden','false');
}

// Délégation : tout clic sur un .consignes-btn ouvre son bloc dédié
document.addEventListener('click', (e) => {
  const btn = e.target.closest('.consignes-btn');
  if (!btn) return;
  const sel = btn.getAttribute('data-consignes');
  if (sel) ouvrirConsignesDepuisSelector(sel);
});

// Fermetures (croix, fond noir, Échap)
document.querySelector('#consignes-overlay .close-consignes').addEventListener('click', fermerConsignes);
document.getElementById('consignes-overlay').addEventListener('click', (e) => {
  if (e.target.id === 'consignes-overlay') fermerConsignes();
});
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') fermerConsignes();
});

function fermerConsignes() {
  const ov = document.getElementById('consignes-overlay');
  ov.classList.remove('open');
  ov.setAttribute('aria-hidden','true');
  document.getElementById('consignes-body').innerHTML = "";
}
// Ouvrir/Replier le panneau outils (en dessous des lignes)
document.querySelectorAll('.tools-area').forEach(zone => {
  const openBtn  = zone.querySelector('.tools-toggle');
  const closeBtn = zone.querySelector('.tools-close');

  if (openBtn){
    openBtn.addEventListener('click', () => {
      zone.classList.add('open');
      openBtn.setAttribute('aria-expanded','true');
    });
  }
  if (closeBtn){
    closeBtn.addEventListener('click', () => {
      zone.classList.remove('open');
      openBtn.setAttribute('aria-expanded','false');
    });
  }
});
</script>
</div>
</body>
</html>


